{% extends "base.html" %}
{% load humanize %}
{% block title %}정기 거래 목록{% endblock %}
{% block content %}
<div class="card fade-in-up delay-1">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span class="page-title">정기 거래 목록</span>
        <a href="{% url 'recurring_create' %}" class="btn btn-primary btn-sm press-effect">+ 정기 거래 등록</a>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>상태</th>
                        <th>구분</th>
                        <th class="text-end">금액</th>
                        <th>계좌</th>
                        <th>카테고리</th>
                        <th>실행일</th>
                        <th>가맹점/메모</th>
                        <th>기간</th>
                        <th>관리</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in items %}
                    <tr{% if not item.is_active %} class="opacity-50"{% endif %}>
                        <td>
                            {% if item.is_active %}
                            <span class="badge bg-success-subtle text-success rounded-pill">활성</span>
                            {% else %}
                            <span class="badge bg-secondary-subtle text-secondary rounded-pill">정지</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.get_tx_type_display == "입금" %}
                            <span class="badge bg-success-subtle text-success rounded-pill">입금</span>
                            {% else %}
                            <span class="badge bg-danger-subtle text-danger rounded-pill">출금</span>
                            {% endif %}
                        </td>
                        <td class="text-end fw-semibold">{{ item.amount|intcomma }}원</td>
                        <td>{{ item.account.name }}</td>
                        <td>{{ item.category|default:"-" }}</td>
                        <td>매달 {{ item.recurring_day }}일</td>
                        <td>{{ item.merchant|default:"" }} {{ item.memo|default:"" }}</td>
                        <td class="text-nowrap">{{ item.start_date }}{% if item.end_date %} ~ {{ item.end_date }}{% else %} ~ 계속{% endif %}</td>
                        <td class="text-nowrap">
                            <a href="{% url 'recurring_update' item.pk %}" class="btn btn-outline-secondary btn-sm">수정</a>
                            <form method="post" action="{% url 'recurring_toggle' item.pk %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-secondary btn-sm">{% if item.is_active %}정지{% else %}재개{% endif %}</button>
                            </form>
                            <a href="{% url 'recurring_delete' item.pk %}" class="btn btn-outline-secondary btn-sm">삭제</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="9" class="text-center text-secondary py-4">등록된 정기 거래가 없습니다.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<p class="text-secondary mt-3" style="font-size:.85rem;">
    정기 거래 자동 실행: <code>python manage.py process_recurring</code>
</p>
{% endblock %}
